# IMO 会议文档分析 — 研究日志

## 项目概述
基于 IMO（国际海事组织）MEPC、MSC、CCC、SSE、ISWG-GHG 等委员会/工作组的会议提案文档，进行文本挖掘与政策分析。

**数据规模：**
- MEPC 77-83（7届海洋环境保护委员会会议）
- MSC 102-109（8届海上安全委员会会议）
- CCC 7-10（4届货物运输分委会）
- SSE 7-11（5届船舶系统与设备分委会）
- ISWG-GHG 16-18（3届温室气体减排工作组会议）
- 总计 2,523 篇提案文档

**已完成模块：**
- [x] PDF 解析 + LLM 结构化提取
- [x] 文本相似度 & 引用网络分析
- [x] 词频统计 & TF-IDF
- [x] BERTopic 主题建模（5个委员会，88个主题）
- [x] LLM 主题标签生成（88个中英文标签）
- [x] 关键词共现网络（Louvain 社群发现）
- [x] 桑基图可视化（按议题/按国家）
- [x] 关键词趋势分析
- [x] 国家/组织参与模式分析（5个委员会）
- [x] 共同提案联盟网络（5个委员会）
- [x] 动态主题演化趋势分析
- [x] 跨委员会深度对比分析
- [x] ISWG-GHG 政策立场检测（Claude 零样本分类）
- [x] Originator 数据修复
- [x] 毕业论文撰写（5章 + 参考文献）
- [x] 论文图表生成（8张 300DPI SCI 风格）
- [x] Word 文档生成（SJTU 模板）
- [x] 答辩 PPT 生成（14页 SJTU 风格）

---

## 2026-02-12

### 1. 桑基图显示 Bug 修复

**问题描述：**
- `topic_attention_sankey.py`（per-country sankey）中，议题标题被截断为 25 字符 + `...`，导致标签难以辨认（如 "REDUCTION OF GHG EMISSION..."）
- `sankey_trends.py` 中标签使用 `\n` 换行符，在 PNG 静态导出中渲染异常
- 两个脚本的桑基图都缺少会议名称轴标注，无法区分各列对应的会议
- `build_per_country_sankey` 中使用截断后的 `short_title` 作为 node_name 的 key，而链接构建也用截断标题匹配，当多个议题截断后相同时会产生碰撞

**修复方案：**
- 将标签中的标题截断阈值从 25 提升到 40 字符
- 将 `\n` 替换为 `<br>` 以适配 Plotly 渲染
- 在 node 内部名称中使用完整标题（而非截断），仅在 label 展示时截断
- 增加 x 轴会议名称标注（通过 annotations）
- 链接颜色从统一灰色改为按议题/国家着色以提高可读性

**修改文件：**
- `src/sankey_trends.py` — 标签换行符修复
- `src/topic_attention_sankey.py` — 标题截断、节点 key 碰撞、链接着色、会议标注

---

### 2. 文本相似度 & 引用网络分析（已完成 ✅）

**目标：** 分析文档间的文本相似关系和跨会议引用关系，追踪政策提案的演化路径。

**实现文件：** `src/citation_network.py`

**方法：**
- 正则提取文档间引用（MEPC/MSC/CCC/SSE/ISWG-GHG xx/x/x 格式）
- TF-IDF 向量化 + 余弦相似度矩阵
- 层次聚类（AgglomerativeClustering）发现文档群组
- 构建有向引用网络（NetworkX DiGraph）
- 识别高被引文档（hub documents）
- 基于议题分组 + 引用路径追踪提案演化链

**运行结果（2026-02-12）：**

| 委员会 | 文档数 | 节点数 | 引用边数 | 聚类数 | Top Hub |
|--------|--------|--------|----------|--------|---------|
| MEPC | 891 | 1065 | 805 | 30 | MEPC 80/17 (38次) |
| MSC | 854 | 934 | 656 | 30 | MSC 100/20 (25次) |
| CCC | 405 | 452 | 256 | 19 | CCC 9/4 (9次) |
| SSE | 355 | 425 | 342 | 17 | MSC 101/24 (15次) |
| ISWG-GHG | 88 | 140 | 113 | 5 | MEPC 81/16 (7次) |

**关键发现（MEPC）：**
- 最长演化链：30篇文档围绕 "HARMFUL AQUATIC ORGANISMS IN BALLAST WATER"
- GHG 减排议题有27篇文档的连续引用链
- 最相似文档对：MEPC 80/INF.11 ↔ MEPC 81/INF.7（相似度 1.0）
- Hub 文档主要是各届会议报告（MEPC xx/17 或 xx/16 系列）

**输出文件（每个委员会）：**
- `citation_network_{PREFIX}.png` — 静态引用网络图
- `citation_network_{PREFIX}.html` — 交互式 Plotly 引用网络
- `similarity_clusters_{PREFIX}.png` — 文档相似度热力图
- `citation_analysis_{PREFIX}.json` — 完整分析统计数据

**注意事项：**
- `json_read.load_data()` 会从 `content` 字段重建 `full_text`，导致 `data_processed.json` 中预存的 `full_text` 丢失。`citation_network.py` 直接读取原始 JSON 绕过此问题。

---

### 3. BERTopic 主题建模（已完成 ✅）

**目标：** 对5个委员会的全部提案文档进行无监督主题发现，替代早期 LDA 方案。

**实现文件：** `src/bertopic_model.py`

**方法：**
- Sentence-BERT (`all-MiniLM-L6-v2`) 编码文档
- UMAP 降维 → HDBSCAN 密度聚类
- c-TF-IDF 生成主题关键词表示
- 每个委员会独立建模

**建模结果：**

| 委员会 | 文档数 | 主题数 | 离群率 |
|--------|--------|--------|--------|
| MEPC | 856 | 11 | 14.7% |
| MSC | 837 | 37 | 17.8% |
| CCC | 396 | 19 | 16.4% |
| SSE | 349 | 12 | 12.9% |
| ISWG-GHG | 85 | 9 | 22.4% |

**输出文件：** `output/{委员会}/bertopic/` 下的模型文件、主题 CSV、交互式 HTML 图

---

### 4. LLM 主题标签生成（已完成 ✅）

**实现文件：** `src/llm_enhance_local.py`

**方法：** 使用 LLM 对 BERTopic 发现的 88 个主题生成中英文语义标签，基于主题关键词和代表性文档。

**输出文件：** `output/llm_topic_labels.json`（88 个主题的中英文标签）

---

### 5. 国家/组织参与模式分析（已完成 ✅）

**实现文件：** `src/country_stance.py`

**方法：**
- 统计各国家/组织在每个委员会的提案数量
- Shannon 熵计算议题多样性指数
- 交叉分析国家的议题偏好

**分析结果（中国）：**
- MEPC 45 篇, MSC 56 篇, CCC 30 篇, SSE 59 篇（排名第一）, ISWG-GHG 9 篇

**输出文件：** `output/stance_analysis/` 下 5 个委员会的 CSV 报告 + 交互式 HTML

---

### 6. 共同提案联盟网络分析（已完成 ✅）

**实现文件：** `src/alliance_network.py`

**方法：**
- 提取 Originator_split 字段，多提交方两两建边
- 边权重 = 联合提案次数
- Louvain 社群发现识别联盟结构
- 力导向布局 + 社群着色可视化

**输出文件：** `output/{委员会}/alliance/` 下的联盟统计 JSON 和网络图

---

### 7. 动态主题演化趋势分析（已完成 ✅）

**实现文件：** `src/dynamic_topics.py`

**方法：** 基于 BERTopic 主题在不同会议届次的文档分布变化，识别上升趋势主题与下降趋势主题。

**输出文件：** `output/dynamic_analysis/` 下的趋势分析报告

---

### 8. 跨委员会深度对比分析（已完成 ✅）

**实现文件：** `src/cross_committee_deep.py`

**方法：**
- 基于主题关键词的 TF-IDF 相似度，构建跨委员会主题相似度矩阵
- 识别桥接国家（在多个委员会活跃的实体）
- 政策关联分析

**关键发现：**
- 跨委员会实体重叠最高：SSE-ISWG-GHG（Jaccard 0.556）

**输出文件：** `output/deep_analysis/` 下的相似度矩阵、协作网络、政策关联

---

### 9. ISWG-GHG 政策立场检测（已完成 ✅）

**实现文件：** `src/stance_detection_claude.py`

**方法：** 使用 Claude 进行零样本（zero-shot）政策立场分类，对 ISWG-GHG 85 篇提案进行立场标注。

**立场分布：**
- GFS（全球燃油标准）：29.4%
- IMSF&F（IMO 基金与融资）：17.6%
- Emissions Pricing（排放定价）：17.6%

**输出文件：** `output/ISWG-GHG/stance_detection_results.json`

---

### 10. Originator 数据修复（已完成 ✅）

**实现文件：** `src/fix_originator.py`

**问题：** SSE 7/8 和 ISWG-GHG 17 的部分文档缺失 Originator 字段。

**方法：** 从 PDF 文件名中提取国家/组织信息，回填缺失字段。

**修复后覆盖率：**
- MEPC 100%, MSC 95.8%, CCC 96.7%, SSE 97.7%, ISWG-GHG 100%

---

### 11. 毕业论文撰写（已完成 ✅）

中文毕设论文，共 5 章 + 参考文献：
1. 绪论
2. 技术方案与方法论
3. 实验结果与分析
4. 讨论
5. 结论

---

### 12. 论文图表生成（已完成 ✅）

**实现文件：** `gen_thesis_figures_v2.py`（位于 workspace）

8 张 300DPI SCI 风格图表：

| 图号 | 文件名 | 内容 |
|------|--------|------|
| 图2-1 | `fig2-1_technical_roadmap.png` | 技术路线图 |
| 图3-1 | `fig3-1_topic_distribution.png` | 委员会主题分布 |
| 图3-2 | `fig3-2_mepc_top10.png` | MEPC 前10活跃实体 |
| 图3-3 | `fig3-3_china_crosscommittee.png` | 中国跨委员会提案 |
| 图3-4 | `fig3-4_mepc_alliance.png` | MEPC 共同提案 Top15 |
| 图3-5 | `fig3-5_iswg_stance.png` | ISWG-GHG 立场分布 |
| 图3-6 | `fig3-6_dynamic_trends.png` | 动态趋势 |
| 图3-7 | `fig3-7_cross_committee_heatmap.png` | 跨委员会热力图 |

**修复记录：**
- 路线图文字重叠问题
- stance 图缺少 session 维度
- topic 分布图标签截断
- heatmap 使用假数据 → 替换为真实分析数据

---

### 13. Word 文档生成（已完成 ✅）

基于 SJTU（上海交通大学）毕设模板，使用 python-docx 生成符合格式要求的 Word 文档。

---

### 14. 答辩 PPT 生成（已完成 ✅）

14 页 SJTU 风格答辩 PPT，涵盖研究背景、方法、结果、结论。

---

## 变更记录

| 日期 | 操作 | 文件 | 说明 |
|------|------|------|------|
| 2026-02-12 | 创建 | 研究日志.md | 初始化研究日志 |
| 2026-02-12 | 修复 | src/sankey_trends.py | 标签换行符 bug |
| 2026-02-12 | 修复 | src/topic_attention_sankey.py | 标题截断/节点碰撞/着色/标注 |
| 2026-02-12 | 新增 | src/alliance_network.py | 共同提案联盟网络分析 |
| 2026-02-12 | 新增 | src/citation_network.py | 文本相似度 & 引用网络分析 |
| 2026-02-12 | 完成 | src/bertopic_model.py | 5个委员会 BERTopic 建模（88个主题） |
| 2026-02-12 | 新增 | src/llm_enhance_local.py | LLM 生成 88 个主题中英文标签 |
| 2026-02-12 | 新增 | output/llm_topic_labels.json | 88 个主题标签 JSON |
| 2026-02-12 | 完成 | src/country_stance.py | 5个委员会国家参与模式分析 |
| 2026-02-12 | 完成 | output/stance_analysis/ | 国家参与分析 CSV + HTML |
| 2026-02-12 | 完成 | output/{委员会}/alliance/ | 5个委员会联盟网络 |
| 2026-02-12 | 完成 | src/dynamic_topics.py | 动态主题演化趋势分析 |
| 2026-02-12 | 完成 | output/dynamic_analysis/ | 趋势分析报告 |
| 2026-02-12 | 新增 | src/cross_committee_deep.py | 跨委员会深度对比分析 |
| 2026-02-12 | 完成 | output/deep_analysis/ | 相似度矩阵、协作网络、政策关联 |
| 2026-02-12 | 新增 | src/stance_detection_claude.py | ISWG-GHG 政策立场检测（Claude） |
| 2026-02-12 | 完成 | output/ISWG-GHG/stance_detection_results.json | 85篇提案立场分类 |
| 2026-02-12 | 新增 | src/fix_originator.py | Originator 数据修复（SSE/ISWG-GHG） |
| 2026-02-12 | 完成 | 毕业论文（5章+参考文献） | 中文毕设论文 |
| 2026-02-12 | 新增 | gen_thesis_figures_v2.py | 8张 SCI 风格论文图表生成 |
| 2026-02-12 | 完成 | figures/fig2-1 ~ fig3-7 | 8张 300DPI 图表 |
| 2026-02-12 | 完成 | 毕业论文 Word 文档 | SJTU 模板 docx 生成 |
| 2026-02-12 | 完成 | 答辩 PPT | 14页 SJTU 风格 PPT |
| 2026-02-12 | 更新 | readme.md | 重写为完整学术项目 README |
| 2026-02-12 | 更新 | 研究日志.md | 追加全天工作记录与变更 |
